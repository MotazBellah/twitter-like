{% extends 'tweets/base.html' %}

{% block title %} - Home{% endblock %}
{% block content %}

    <div class="row text-center">
        <div class="col">
            <h2>Welcom to Tweetme</h2>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-4 mx-auto col-10">
            <form class="form" action="/create-tweet" method="post">{% csrf_token %}
                <input type="hidden" name="next" value="/">
                <textarea class="form-control" name="content" placeholder="Your tweet..."></textarea>
                <button class="btn btn-primary" type="submit" name="button">Tweet</button>
            </form>

        </div>
    </div>

    <!-- <div class="row"> -->
        <div class="row" id="tweets">
            Loading...
        </div>

    <!-- </div> -->

    <script type="text/javascript">
        const tweetsElement = document.getElementById("tweets")

        const xhr = new XMLHttpRequest()
        const method = 'GET'
        const url = '/tweets'
        const responseType = 'json'

        function handleDidLike(tweet_id, currentCount) {
            console.log(tweet_id, currentCount)
            //currentCount++
            return
        }

        function LikeBtn(tweet) {
            return "<button class='btn btn-primary btn-sm' onclick=handleDidLike(" +
            tweet.id + "," + tweet.likes + ")>" + tweet.likes + " Likes</button>"
        }

        function formatTweetElement(tweet) {
            var formattedTweet = "<div class='col-12 col-md-10 mx-auto border rounded py-3 mb-4 tweet' id='tweet-" + tweet.id
            + "'><p>" + tweet.content +
                "</p><div class='btn-group'>" + LikeBtn(tweet) +
                "</div></div>"
            return formattedTweet
        }

        xhr.responseType = responseType
        xhr.open(method, url)
        xhr.onload = function() {
            console.log(xhr.response)
            const listedItems = xhr.response.response
            let finalTweetStr = ''
            for(let i=0; i < listedItems.length; i++) {
                console.log(listedItems[i])
                var currentItem = formatTweetElement(listedItems[i])
                finalTweetStr += currentItem
            }

            tweetsElement.innerHTML = finalTweetStr

        }

        xhr.send()

    </script>
{% endblock content %}
